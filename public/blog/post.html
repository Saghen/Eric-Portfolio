<html>

<head>
    <!DOCTYPE html>
    <title>Sea of Electrons Blog</title>
    <!-- Loads code highlighter -->
    <script src="https://cdn.jsdelivr.net/highlight.js/latest/highlight.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/highlight.js/latest/styles/github.min.css">

    <link href="https://fonts.googleapis.com/css?family=Assistant" rel="stylesheet">

    <!-- My Files -->
    <link rel="stylesheet" type="text/css" href="../css/core.css">
    <link rel="stylesheet" type="text/css" href="../css/blog.css">
    <link rel="stylesheet" type="text/css" href="../css/blogentry.css">
    <script src="../js/vue.min.js"></script>
    <script src="../js/core.js"></script>
    <script src="../js/showdown.min.js"></script>
    <meta charset="utf-8">
    <meta name="description" content="Website for Eric for his blog and things.">
    <meta name="keywords" content="PCBs, Circuits, Technology, Eric Dyer, Coding, Programming">
    <meta name="author" content="Liam Dyer">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://saghen.github.io/Eric-Portfolio/imgs/og_image.png">
    <meta property="og:title" content="Sea of Technology">
    <meta property="og:locale" content="en_US">
    <meta property="og:description" content="Website for Eric for his blog and things.">
    <link rel="canonical" href="https://saghen.github.io/Eric-Portfolio/">
    <meta property="og:url" content="https://saghen.github.io/Eric-Portfolio/">
    <meta property="og:site_name" content="Sea of Technology">
</head>

<body>
    <header id="Header">
        <ul id="nav">
            <li>
                <a href="../">Home</a>
            </li>
            <li>
                <a href="../#aboutme">About</a>
            </li>
            <li>
                <a href="../#experience">Experience</a>
            </li>
            <li>
                <a href="./">Blog</a>
            </li>
            <li>
                <a href="../#contact">Contact</a>
            </li>
        </ul>
    </header>
    <div id="wrapper">
        <div id="authorandinfo">
            <img id="authorimg" :src="profileImg">
            <div>
                <span>{{ author }}</span>
                <span style="color:#555; margin-top: 3px;">{{ date }} â€¢ {{ length }}</span>
            </div>
        </div>
        <img id="splashimage" :src="'../imgs/' + splashImg">
        <div id="content">
            <h1>{{ title }}</h1>
            <blog-content></blog-content>
        </div>
        <script>
            function getParameterByName(name, url) {
                if (!url) url = window.location.href;
                name = name.replace(/[\[\]]/g, "\\$&");
                var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
                    results = regex.exec(url);
                if (!results) return null;
                if (!results[2]) return '';
                return decodeURIComponent(results[2].replace(/\+/g, " "));
            }

            let blogInfo = {};

            fetch(`./getinfo/${getParameterByName("id")}`).then(res => res.json()).then(function (json) {
                blogInfo = json;
                var converter = new showdown.Converter();
                let template = converter.makeHtml(blogInfo.content);
                template = template.replace(/(\r\n|\n|\r)/gm, "");

                Vue.component('blog-content', {
                    template: '<div>' + template + '</div>',
                    mounted: function () {
                        var code = document.getElementsByTagName("code");
                        for (let x in code) {
                            hljs.highlightBlock(code[x]);
                        }
                    }
                });
            });

            app = new Vue({
                el: '#wrapper',
                data: {
                    author: "",
                    date: "",
                    length: "",
                    profileImg: "",
                    splashImg: "",
                    title: ""
                },
                created() {
                    fetch(`./getinfo/${getParameterByName("id")}`).then(res => res.json()).then(json => {
                        this.date = json.dateposted;
                        this.length = json.length;
                        this.splashImg = json.image;

                        this.title = json.title;

                        fetch(`./getauthor?name=${json.author}`).then(res => res.json()).then(authorInfo => {
                            this.author = authorInfo.authorname;
                            this.profileImg = authorInfo.authorimg;
                        });
                    });
                }
            });
        </script>
    </div>
</body>

</html>